<script type="text/javascript">
$('#binduser-datagrid').datagrid({
    gridTitle : '用户列表',
    showToolbar: false,
    toolbarItem: 'add',
    toolbarCustom: '<a href="<?php echo U("role/datagrid-lookup-nation")?>" class="btn btn-default" data-toggle="dialog" data-width="800" data-height="400" data-id="dialog">分配权限</a>',
    local: 'remote',
    dataUrl: "<?php echo U('Admin/bindUserList')?>",
    dataType: 'json',
//    sortAll: true,
    filterAll: false,
    columns: [
        {
            name: 'user_name',
            label: '姓名',
            align: 'center',
            width: 80,
        },
        {
            name: 'department',
            label: '部门',
            align: 'center',
            width: 80,
        },
        {
            name: 'user_email',
            label: '邮箱',
            align: 'center',
            width: 150,
        },
        {
            name: 'uid',
            label: '绑定',
            align: 'center',
            width: 80,
            render: function(value) {
                return  '<a href="<?php echo U('Admin/bindUser')?>?uid='+value+'&admin_id=<?php echo $admin_id?>" class="btn btn-red" data-toggle="doajax" data-confirm-msg="确定要关联？">关联</a>';
            }
        },
    ],
    hiddenFields: [{name:'deptcode'}],
    editUrl: '<?php echo U("Admin/save_admin")?>',
    delUrl:  '<?php echo U("Admin/del_admin")?>',
    delPK:'admin_id',
    paging: {pageSize:10, pageCurrent:1},
    showCheckboxCol: true,
    showEditBtnsCol: true,
    linenumberAll: true,
    showTfoot: true,
    contextMenuB: false,
    columnMenu:false,
//    fullGrid:true
})
</script>
<div class="bjui-pageContent">
<script type="text/javascript">
var $datagrid = $('#binduser-datagrid')

$(document).on('bjui.beforeCloseDialog', function(e) {
    var $dialog = $(e.target);
//    debugger;
    $dialog.data = "{'admin_id':'1'}";
//    var $select = $('#test-datagrid').data('selectedTrs');
//    $(this).navtab('reloadFlag', '1');

 });
 $(document).on('bjui.beforeLoadDialog', function(e) {
    var $dialog = $(e.target);
//    debugger;
//    $dialog.prototype.getCurrent;
//    var $select = $('#test-datagrid').data('selectedTrs')
//    $dialog.loadUrl("<?=U('admin/edit')?>","admin_id:"+$select);
//    var $select = $('#test-datagrid').data('selectedTrs');
//    $(this).navtab('reloadFlag', 'bjui-hnav-tree1_2');
//    $(this).loadUrl({'url': '<?=U('admin/edit')?>','data':{'admin_id':'11'},'target':null});

 })
</script>
    <div style="margin:15px;">
        <table id="binduser-datagrid" data-width="100%" data-height="500" class="table table-bordered">
        </table>
    </div>
    <a id="doc-alertmsg-demo"></a >
</div>